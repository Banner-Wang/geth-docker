apiVersion: v1
kind: Service
metadata:
  name: gethrpc
spec:
  ports:
    - protocol: TCP
      port: 8545
      nodePort: 38545
      name: jsonrpc
    - protocol: TCP
      port: 8546
      nodePort: 38546
      name: websoket
    - protocol: TCP
      port: 8547
      nodePort: 38547
      name: graphql
  clusterIP: None
  selector:
    app: geth-node

---
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: geth
spec:
  selector:
    matchLabels:
      app: geth-node
  replicas: 2
  serviceName: gethrpc
  template:
    metadata:
      label:
        app: geth-node
    spec:
      containers:
        - name: geth
          image: ethereum/client-go:v1.9.14
          resources:
            limits: { cpu: "8000m", memory: "16G" }
            requests: { cpu: "8000m", memory: "16G" }
          ports:
            - containerPort: 8545
            - containerPort: 8546
            - containerPort: 8547
            - { containerPort: 30303, protocol: TCP }
            - { containerPort: 30303, protocol: UDP }
          args:
            [
              "--http",
              "--http.api",
              "eth,txpool,net,web3",
              "--http.vhosts=*",
              "--http.corsdomain=*",
              "--ws",
              "--ws.addr=0.0.0.0",
              "--ws.origin=*",
              "--ws.api",
              "eth,net,web3,txpoll",
              "--graphql",
              "--graphql.addr=0.0.0.0",
              "--graphql.corsdomain=*",
              "--graphql.vhosts=*",
              "--datadir",
              "/chaindata",
            ]
          volumeMounts:
            - name: chaindata
              mountPath: /chaindata
      volumeClaimTemplates:
        - metadata:
            name: chaindata
          spec:
            accessModes: ["ReadWriteOnce"]
            storageClassName: YOUR_STORAGE_CLASS_NAME
            resources:
              requests:
                storage: 500Gi
